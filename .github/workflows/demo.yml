name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]

env:
  ap_url: https://data.vlaanderen.be/doc/applicatieprofiel/leermiddelen/ontwerpstandaard/2025-03-21/
  shacl_url: https://data.vlaanderen.be/doc/applicatieprofiel/leermiddelen/ontwerpstandaard/2025-03-21/shacl/leermiddelen-ap-SHACL.ttl

jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v5
      - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      - name: Download SHACL if needed
        run: ./download-shacl.sh $shacl_url
      - uses: EndBug/add-and-commit@v9
        with:
          add: shacl.ttl
          message: "Add SHACL"
      - name: Add AP and SHACL links to README
        run: ./update-readme.sh $ap_url $shacl_url
      - uses: EndBug/add-and-commit@v9
        with:
          add: README.md original-README.md
          message: "Add AP and SHACL links to README"
      - name: "[Placeholder] Generate template Excel"
        run: echo "Generating Excel template."
      - name: Create output directory
        run: mkdir -p output
      - name: Create docs directory
        run: mkdir -p docs
      - name: "[Placeholder] Generate RDF"
        run: echo "Putting dummy data in output directory" && curl -L https://work.de-meester.org/assets/2025/output.ttl -o output/data.ttl
      - uses: EndBug/add-and-commit@v9
        with:
          add: output/data.ttl
          message: "Add generated RDF"
      - name: Clone Miravi repository
        uses: actions/checkout@v5
        with:
          repository: SolidLabResearch/miravi-a-linked-data-viewer
      - uses: actions/setup-node@v6
        with:
          node-version: 22
      - name: Build Miravi website
        run: |
          cd miravi-a-linked-data-viewer
          npm i
          node scripts/select-config.cjs demo
          npm run build
      - name: Move Miravi dist directory to docs
        run: mv miravi-a-linked-data-viewer/main/dist docs
      - uses: EndBug/add-and-commit@v9
        with:
          add: docs
          message: "Add Miravi build"
