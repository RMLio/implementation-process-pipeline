name: Implementation process pipeline
run-name: ${{ github.actor }} is running the pipeline
on: [push]

env:
  ap_url: https://data.vlaanderen.be/doc/applicatieprofiel/leermiddelen/ontwerpstandaard/2025-03-21/
  shacl_url: https://data.vlaanderen.be/doc/applicatieprofiel/leermiddelen/ontwerpstandaard/2025-03-21/shacl/leermiddelen-ap-SHACL.ttl

jobs:
  Set-Up-Repo:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v5
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: Download SHACL if needed
        run: ./scripts/download-shacl.sh $shacl_url
      - uses: EndBug/add-and-commit@v9
        with:
          add: shacl.ttl
          message: "Add SHACL"
      - name: Add AP and SHACL links to README
        run: ./scripts/update-readme.sh $ap_url $shacl_url
      - uses: EndBug/add-and-commit@v9
        with:
          add: README.md original-README.md
          message: "Add AP and SHACL links to README"
      - name: "[Placeholder] Generate template Excel"
        run: echo "Generating Excel template."
      - name: Create output directory
        run: mkdir -p output

  Generate-RDF:
    runs-on: ubuntu-latest
    needs: Set-Up-Repo
    steps:
      - name: Check out repository code
        uses: actions/checkout@v5
      - name: "[Placeholder] Generate RDF"
        run: echo "Putting dummy data in output directory" && curl -L https://work.de-meester.org/assets/2025/output.ttl -o output/data.ttl
      - uses: EndBug/add-and-commit@v9
        with:
          add: output/data.ttl
          message: "Add generated RDF"

  Build-Miravi:
    runs-on: ubuntu-latest
    needs: Generate-RDF
    steps:
      - name: Check out repository code
        uses: actions/checkout@v5
      - name: Clone Miravi repository
        uses: actions/checkout@v5
        with:
          repository: SolidLabResearch/miravi-a-linked-data-viewer
          path: miravi-a-linked-data-viewer
      - uses: actions/setup-node@v6
        with:
          node-version: 22
      - name: Build Miravi website
        run: |
          cd miravi-a-linked-data-viewer/main
          npm i
          node scripts/select-config.cjs demo
          npm run build
      - name: Clean docs directory
        run: rm -rf docs && mkdir docs
      - name: Move Miravi dist directory to docs
        run: mv miravi-a-linked-data-viewer/main/dist/* docs
      - uses: EndBug/add-and-commit@v9
        with:
          add: docs
          message: "Add Miravi build"
